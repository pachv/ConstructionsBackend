{{define "content"}}
<h2>Prices</h2>

<!-- Success message -->
<div id="success-message" class="alert alert-success text-center fw-bold py-2"
    style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 300px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
    Prices successfully saved!
</div>

<!-- Error message -->
<div id="error-message" class="alert alert-danger text-center fw-bold py-2"
    style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 300px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
    Error saving prices!
</div>

<form id="pricesForm">
    <div class="mt-4">

        <!-- English Prices -->
        <h4 class="mb-3 border-bottom pb-2">English Prices</h4>
        <div class="row g-4">
            {{range .EnglishPrices}}
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">

                        <input type="hidden" name="price_id_{{.PriceId}}" value="{{.PriceId}}">
                        <input type="hidden" name="ton_id_{{.PriceId}}" value="{{.PriceTonId}}">
                        <input type="hidden" name="stars_id_{{.PriceId}}" value="{{.PriceStarsId}}">

                        <div class="mb-2">
                            <label class="form-label fw-bold">Title</label>
                            <input type="text" name="title_{{.PriceId}}" class="form-control" value="{{.PriceTitle}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Description</label>
                            <input type="text" name="description_{{.PriceId}}" class="form-control"
                                value="{{.PriceDescription}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Reward Type</label>
                            <p class="form-control-plaintext">{{.PriceRewardType}}</p>
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Reward Amount</label>
                            <input type="number" step="1" name="reward_amount_{{.PriceId}}" class="form-control"
                                value="{{.PriceRewardAmount}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">TON Amount</label>
                            <input type="number" step="0.0001" name="ton_amount_{{.PriceId}}" class="form-control"
                                value="{{.PriceTonAmount}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Stars Amount</label>
                            <input type="number" step="1" name="stars_amount_{{.PriceId}}" class="form-control"
                                value="{{.PriceStarsAmount}}">
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        </div>

        <!-- Arabic Prices -->
        <h4 class="mt-5 mb-3 border-bottom pb-2">Arabic Prices</h4>
        <div class="row g-4">
            {{range .ArabicPrices}}
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">

                        <input type="hidden" name="price_id_{{.PriceId}}" value="{{.PriceId}}">
                        <input type="hidden" name="ton_id_{{.PriceId}}" value="{{.PriceTonId}}">
                        <input type="hidden" name="stars_id_{{.PriceId}}" value="{{.PriceStarsId}}">

                        <div class="mb-2">
                            <label class="form-label fw-bold">Title</label>
                            <input type="text" name="title_{{.PriceId}}" class="form-control" value="{{.PriceTitle}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Description</label>
                            <input type="text" name="description_{{.PriceId}}" class="form-control"
                                value="{{.PriceDescription}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Reward Type</label>
                            <p class="form-control-plaintext">{{.PriceRewardType}}</p>
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Reward Amount</label>
                            <input type="number" step="1" name="reward_amount_{{.PriceId}}" class="form-control"
                                value="{{.PriceRewardAmount}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">TON Amount</label>
                            <input type="number" step="0.0001" name="ton_amount_{{.PriceId}}" class="form-control"
                                value="{{.PriceTonAmount}}">
                        </div>

                        <div class="mb-2">
                            <label class="form-label fw-bold">Stars Amount</label>
                            <input type="number" step="1" name="stars_amount_{{.PriceId}}" class="form-control"
                                value="{{.PriceStarsAmount}}">
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        </div>

        <div class="row mt-4">
            <div class="col-10 mx-auto">
                <button type="submit" class="btn btn-primary w-100 py-2 fs-5"> Save Prices</button>
            </div>
        </div>
    </div>
</form>

<script>
    document.getElementById('pricesForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const form = e.target;
        const prices = [];

        const priceInputs = form.querySelectorAll('input[name^="price_id_"]');

        priceInputs.forEach(input => {
            const id = input.value;
            prices.push({
                PriceId: id,
                PriceTitle: form.querySelector(`[name="title_${id}"]`).value,
                PriceDescription: form.querySelector(`[name="description_${id}"]`).value,
                PriceRewardAmount: parseInt(form.querySelector(`[name="reward_amount_${id}"]`).value),
                PriceTonId: form.querySelector(`[name="ton_id_${id}"]`).value,
                PriceStartsId: form.querySelector(`[name="stars_id_${id}"]`).value,
                PriceTonAmount: parseFloat(form.querySelector(`[name="ton_amount_${id}"]`).value),
                PriceStarsAmount: parseInt(form.querySelector(`[name="stars_amount_${id}"]`).value)
            });
        });



        try {
            const res = await fetch('{{.SendPricesURL}}', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(prices)
            });
            const data = await res.json();
            if (res.ok) {
                const msg = document.getElementById('success-message');
                msg.style.display = 'block';
                setTimeout(() => { msg.style.display = 'none'; }, 1500);
            } else {
                const errMsg = document.getElementById('error-message');
                errMsg.textContent = ` Error saving prices: ${err.message}`;
                errMsg.style.display = 'block';
            }
        } catch (err) {
            const errMsg = document.getElementById('error-message');
            errMsg.textContent = ` Error saving prices: ${err.message}`;
            errMsg.style.display = 'block';
        }
    });
</script>

{{end}}